# 📋 本地化个人交易记忆系统 (MyTradeMind) 需求分析文档

## 1. 项目概述与目标

### 1.1 项目背景
针对个人交易者需要一个本地化、隐私保护的交易分析系统，结合知识图谱技术构建个人交易记忆系统，帮助用户分析历史交易数据、交易行为与情绪，完善交易体系并提高执行力。

### 1.2 核心目标
构建一个基于知识图谱的本地化AI交易辅助系统，所有数据本地存储，不依赖任何云端LLM或数据库进行核心数据分析。

## 2. 功能需求列表 (EARS格式)

### 2.1 数据摄入与管理模块

#### F1.1 交易记录导入
**Event**: 用户上传CSV/Excel格式的券商交割单
**Actor**: 具备技术背景的个人交易者
**Request**: 系统应清洗并标准化数据，存储到本地SQLite数据库
**Scope**: 仅支持券商交割单格式，支持CSV/Excel文件类型

#### F1.2 策略/文档导入
**Event**: 用户上传PDF、Markdown或TXT格式的交易哲学文档、策略定义
**Actor**: 具备技术背景的个人交易者
**Request**: 系统应将文档作为非结构化数据源导入Cognee知识图谱
**Scope**: 支持PDF、Markdown、TXT文件类型，文件大小限制在10MB以内

#### F1.3 情绪/日志记录
**Event**: 用户通过界面输入交易情绪、理由、复盘心得
**Actor**: 具备技术背景的个人交易者
**Request**: 系统应将输入文本立即送入Cognee进行知识图谱实体与关系抽取
**Scope**: 支持纯文本输入，单条记录限制在1000字以内

#### F1.4 行情数据接口
**Event**: 每日收盘后系统自动触发
**Actor**: 系统后台服务
**Request**: 内建AkShare或其他本地Python库获取用户持仓股票的最新收盘价和关键指数信息
**Scope**: 仅获取用户持仓股票数据，每日自动执行一次

### 2.2 知识图谱构建与检索模块

#### F2.1 实体与关系抽取
**Event**: 用户输入情绪/日志记录或导入策略文档
**Actor**: Cognee LLM Agent
**Request**: 自动从文本中抽取关键实体和关系，包括：
- 实体(Node): 交易事件、情绪（贪婪/恐惧/焦虑）、策略名称、市场观点、股票代码
- 关系(Edge): 执行于、源于、导致、不符合、锚定
**Scope**: 仅处理用户提供的交易相关文本数据

#### F2.2 图谱可视化
**Event**: 用户访问图谱可视化页面
**Actor**: 具备技术背景的个人交易者
**Request**: 调用cognee.visualize_graph()展示核心实体节点及其关系的交互式图谱，支持按情绪（如"焦虑"）筛选节点
**Scope**: 展示Cognee构建的知识图谱，支持基本筛选功能

#### F2.3 图谱检索优化
**Event**: LLM Agent接收到用户查询
**Actor**: 系统LLM Agent
**Request**: 先在Cognee图谱中检索关系上下文，再将结果作为Prompt补充信息送入Ollama
**Scope**: 所有LLM查询均需经过图谱增强检索

### 2.3 交易分析与对话模块

#### F3.1 Web Chat界面
**Event**: 用户访问系统Web界面
**Actor**: 具备技术背景的个人交易者
**Request**: 构建类似ChatGPT的对话界面，支持历史记录功能
**Scope**: 使用Streamlit或Chainlit构建Web应用

#### F3.2 数据查询工具
**Event**: 用户通过Chat界面提问交易数据相关问题
**Actor**: 具备技术背景的个人交易者
**Request**: LLM应生成并执行SQL查询，解读结果并返回给用户
**Scope**: 支持基于SQLite数据库的Text-to-SQL查询

#### F3.3 每日复盘Agent
**Event**: 每日系统自动触发
**Actor**: 系统LLM Agent
**Request**: 加载昨日交易数据和相关知识图谱记忆，生成结构化复盘报告，包括：
- 账户净值变化与市场对比
- 操作是否符合策略的判定
- 情绪驱动的操作提醒
**Scope**: 每日自动生成，报告内容基于本地数据

#### F3.4 交易计划Agent
**Event**: 用户通过Chat界面提问交易计划相关问题
**Actor**: 具备技术背景的个人交易者
**Request**: Agent根据用户风险偏好和当前持仓，给出明日的行动建议（止盈/止损位，加仓/减仓逻辑）
**Scope**: 仅基于本地数据生成建议，不包含外部投资咨询

## 3. 非功能需求

### 3.1 隐私与安全
- 所有用户数据（交易记录、日志、图谱）必须本地存储，绝对禁止上传至任何外部服务器
- LLM调用、数据库存储和计算必须在本地完成

### 3.2 性能
- 知识图谱的构建（F2.1）应在3分钟内完成对一次日记的抽取
- 对话交互的响应时间（F3.1）应在10秒内
- 数据导入（F1.1, F1.2）应在1分钟内完成（单文件大小不超过10MB）

### 3.3 可部署性
- 提供清晰的README和requirements.txt文档
- 支持通过Docker或Python虚拟环境快速部署
- 支持macOS操作系统

### 3.4 用户体验
- Web界面应清晰展示持仓情况和净值曲线
- 对话界面应提供历史记录功能
- 图谱可视化界面应支持交互式操作

### 3.5 兼容性
- 支持CSV/Excel格式的券商交割单导入
- 支持PDF/Markdown/TXT格式的文档导入
- 兼容Ollama支持的本地LLM模型（Qwen2.5/Llama3.1）

## 4. 验收标准

### 4.1 功能需求验收标准

| 需求ID | 验收标准 |
|--------|----------|
| F1.1   | 1. 成功导入CSV/Excel格式交割单<br>2. 数据正确清洗并标准化<br>3. 数据成功存储到SQLite数据库 |
| F1.2   | 1. 成功导入PDF/Markdown/TXT格式文档<br>2. 文档内容正确存入Cognee知识图谱 |
| F1.3   | 1. 成功输入情绪/日志记录<br>2. 记录立即送入Cognee进行实体与关系抽取<br>3. 抽取结果可在图谱中查看 |
| F1.4   | 1. 每日收盘后自动触发数据获取<br>2. 成功获取持仓股票最新收盘价和关键指数信息<br>3. 数据正确更新到SQLite数据库 |
| F2.1   | 1. 成功从文本中抽取定义的实体类型<br>2. 成功从文本中抽取定义的关系类型<br>3. 抽取过程在3分钟内完成 |
| F2.2   | 1. 生成交互式图谱可视化页面<br>2. 支持按情绪节点筛选<br>3. 正确展示实体间关系 |
| F2.3   | 1. LLM查询时先检索图谱上下文<br>2. 检索结果正确作为Prompt补充信息 |
| F3.1   | 1. 搭建Streamlit/Chainlit对话界面<br>2. 支持历史记录功能<br>3. 响应时间在10秒内 |
| F3.2   | 1. 支持自然语言提问交易数据<br>2. 正确生成SQL查询并执行<br>3. 准确解读并返回查询结果 |
| F3.3   | 1. 每日自动生成复盘报告<br>2. 报告包含净值变化、策略符合度、情绪分析<br>3. 报告内容基于本地数据生成 |
| F3.4   | 1. 基于用户风险偏好生成建议<br>2. 基于当前持仓生成具体行动建议<br>3. 建议内容合理且可操作 |

### 4.2 非功能需求验收标准

| 需求ID | 验收标准 |
|--------|----------|
| N1     | 1. 使用网络监控工具验证无数据上传<br>2. 所有计算过程在本地完成 |
| N2     | 1. 知识图谱构建时间<3分钟<br>2. 对话响应时间<10秒<br>3. 数据导入时间<1分钟 |
| N3     | 1. 提供完整的README文档<br>2. 提供准确的requirements.txt<br>3. 成功通过Docker或虚拟环境部署 |
| N4     | 1. 界面清晰展示持仓情况<br>2. 界面清晰展示净值曲线<br>3. 支持对话历史记录查看 |
| N5     | 1. 成功导入多种格式的交割单<br>2. 成功导入多种格式的文档<br>3. 兼容至少两种本地LLM模型 |

## 5. 潜在约束与限制

### 5.1 技术约束
- 必须使用Ollama作为本地LLM引擎
- 必须使用Cognee构建知识图谱
- 必须使用SQLite作为本地数据库
- 前端必须使用Streamlit或Chainlit
- 仅支持macOS操作系统

### 5.2 数据约束
- 交易记录仅支持券商交割单格式
- 文档导入单文件大小限制在10MB以内
- 日志记录单条限制在1000字以内

### 5.3 性能约束
- 由于使用本地LLM，推理速度可能慢于云端服务
- 知识图谱规模受本地硬件资源限制

### 5.4 功能约束
- MVP阶段仅实现核心功能，高级分析功能将在后续迭代中实现
- 不提供实时行情数据，仅每日收盘后更新
- 不包含外部投资咨询功能，所有建议基于用户本地数据

## 6. MVP阶段范围

MVP阶段聚焦于以下核心功能：
1. 数据导入 (F1.1, F1.3): 实现交割单CSV导入SQLite和情绪/日志文本输入
2. 图谱构建核心 (F2.1): 确保Cognee能成功配置并抽取[情绪]->[交易事件]的关系
3. 图谱可视化 (F2.2): 能够生成交互式HTML图谱，证明Cognee成功工作
4. 基础对话 (F3.1, F3.2): 搭建Streamlit界面，实现基本的Chat功能，并让LLM能够进行简单的Text-to-SQL基础查询
